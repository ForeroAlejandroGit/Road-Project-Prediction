<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Predicci√≥n de Costos - Proyectos Viales</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://unpkg.com/vue@3.3.4/dist/vue.global.js"></script>
</head>
<body>
    <div id="app">
        {% raw %}
        <header>
            <div class="container">
                <h1>üõ£Ô∏è Sistema de Predicci√≥n de Costos en Proyectos Viales</h1>
                <nav>
                    <button @click="currentView = 'inicio'" :class="{active: currentView === 'inicio'}">Inicio</button>
                    <button @click="currentView = 'nuevo'" :class="{active: currentView === 'nuevo'}">Nuevo Proyecto</button>
                    <button @click="currentView = 'detalle'" :class="{active: currentView === 'detalle'}" v-if="selectedProyecto">Detalle Proyecto</button>
                    <button @click="currentView = 'historicos'" :class="{active: currentView === 'historicos'}">Hist√≥ricos</button>
                    <button @click="currentView = 'modelo'" :class="{active: currentView === 'modelo'}">Modelo Predictivo</button>
                </nav>
            </div>
        </header>

        <main class="container">
            <div v-if="currentView === 'inicio'" class="view-inicio">
                <div class="grid">
                    <div class="map-section">
                        <h2>Mapa de Proyectos</h2>
                        <div id="map"></div>
                    </div>
                    
                    <div class="table-section">
                        <h2>Proyectos Activos</h2>
                        <div class="table-container">
                            <table>
                                <thead>
                                    <tr>
                                        <th>Proyecto</th>
                                        <th>C√≥digo</th>
                                        <th># UF's</th>
                                        <th>Longitud (km)</th>
                                        <th>A√±o</th>
                                        <th>Duraci√≥n</th>
                                        <th>Fase</th>
                                        <th>Ubicaci√≥n</th>
                                        <th>$ Causado</th>
                                        <th>Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-for="proyecto in proyectos" 
                                        :key="proyecto.id" 
                                        @click="selectProyecto(proyecto)"
                                        :class="{selected: selectedProyecto && selectedProyecto.id === proyecto.id}">
                                        <td>{{ proyecto.nombre }}</td>
                                        <td>{{ proyecto.codigo }}</td>
                                        <td>{{ proyecto.num_ufs }}</td>
                                        <td>{{ proyecto.longitud }}</td>
                                        <td>{{ proyecto.anio_inicio }}</td>
                                        <td>{{ proyecto.duracion }}</td>
                                        <td>{{ proyecto.fase }}</td>
                                        <td>{{ proyecto.ubicacion }}</td>
                                        <td>${{ formatNumber(proyecto.costo) }}</td>
                                        <td class="actions">
                                            <button @click.stop="editProyecto(proyecto)" class="btn-edit">‚úèÔ∏è</button>
                                            <button @click.stop="deleteProyecto(proyecto.id)" class="btn-delete">üóëÔ∏è</button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <div v-if="currentView === 'nuevo'" class="view-form">
                <h2>{{ editingProyecto ? 'Editar Proyecto' : 'Nuevo Proyecto' }}</h2>
                <form @submit.prevent="saveProyecto">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Nombre del Proyecto</label>
                            <input v-model="form.nombre" required>
                        </div>
                        
                        <div class="form-group">
                            <label>C√≥digo</label>
                            <input v-model="form.codigo" required>
                        </div>
                        
                        <div class="form-group">
                            <label>N√∫mero de UF's</label>
                            <input v-model.number="form.num_ufs" type="number" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Longitud (km)</label>
                            <input v-model.number="form.longitud" type="number" step="0.01" required>
                        </div>
                        
                        <div class="form-group">
                            <label>A√±o de Inicio</label>
                            <input v-model.number="form.anio_inicio" type="number" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Duraci√≥n (meses)</label>
                            <input v-model.number="form.duracion" type="number" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Fase</label>
                            <select v-model="form.fase" required>
                                <option>Detalle</option>
                                <option>Ejecuci√≥n</option>
                                <option>Terminado</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label>Ubicaci√≥n</label>
                            <input v-model="form.ubicacion" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Costo</label>
                            <input v-model.number="form.costo" type="number" step="0.01" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Latitud Inicio</label>
                            <input v-model.number="form.lat_inicio" type="number" step="0.0001" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Longitud Inicio</label>
                            <input v-model.number="form.lng_inicio" type="number" step="0.0001" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Latitud Fin</label>
                            <input v-model.number="form.lat_fin" type="number" step="0.0001" required>
                        </div>
                        
                        <div class="form-group">
                            <label>Longitud Fin</label>
                            <input v-model.number="form.lng_fin" type="number" step="0.0001" required>
                        </div>
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" class="btn-primary">{{ editingProyecto ? 'Actualizar' : 'Crear' }} Proyecto</button>
                        <button type="button" @click="cancelForm" class="btn-secondary">Cancelar</button>
                    </div>
                </form>
            </div>

            <div v-if="currentView === 'detalle' && selectedProyecto" class="view-detalle">
                <h2>Detalle del Proyecto</h2>
                <div class="detalle-card">
                    <h3>{{ selectedProyecto.nombre }}</h3>
                    <div class="detalle-grid">
                        <div class="detalle-item">
                            <span class="label">C√≥digo:</span>
                            <span class="value">{{ selectedProyecto.codigo }}</span>
                        </div>
                        <div class="detalle-item">
                            <span class="label">UF's:</span>
                            <span class="value">{{ selectedProyecto.num_ufs }}</span>
                        </div>
                        <div class="detalle-item">
                            <span class="label">Longitud:</span>
                            <span class="value">{{ selectedProyecto.longitud }} km</span>
                        </div>
                        <div class="detalle-item">
                            <span class="label">A√±o Inicio:</span>
                            <span class="value">{{ selectedProyecto.anio_inicio }}</span>
                        </div>
                        <div class="detalle-item">
                            <span class="label">Duraci√≥n:</span>
                            <span class="value">{{ selectedProyecto.duracion }} meses</span>
                        </div>
                        <div class="detalle-item">
                            <span class="label">Fase:</span>
                            <span class="value">{{ selectedProyecto.fase }}</span>
                        </div>
                        <div class="detalle-item">
                            <span class="label">Ubicaci√≥n:</span>
                            <span class="value">{{ selectedProyecto.ubicacion }}</span>
                        </div>
                        <div class="detalle-item">
                            <span class="label">Costo:</span>
                            <span class="value">${{ formatNumber(selectedProyecto.costo) }}</span>
                        </div>
                    </div>
                    <div class="detalle-map">
                        <div id="detalle-map" style="height: 400px; width: 100%;"></div>
                    </div>
                </div>
            </div>

            <div v-if="currentView === 'historicos'" class="view-historicos">
                <h2>An√°lisis Hist√≥rico</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Proyectos</h3>
                        <p class="stat-value">{{ proyectos.length }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Inversi√≥n Total</h3>
                        <p class="stat-value">${{ formatNumber(totalInversion) }}</p>
                    </div>
                    <div class="stat-card">
                        <h3>Longitud Total</h3>
                        <p class="stat-value">{{ totalLongitud.toFixed(2) }} km</p>
                    </div>
                    <div class="stat-card">
                        <h3>Costo Promedio/km</h3>
                        <p class="stat-value">${{ formatNumber(costoPromedioKm) }}</p>
                    </div>
                </div>
            </div>

            <div v-if="currentView === 'modelo'" class="view-modelo">
                <h2>Modelo Predictivo de Costos</h2>
                <div class="prediccion-card">
                    <h3>Predicci√≥n de Costo</h3>
                    <p class="info">Ingrese los par√°metros del proyecto para obtener una estimaci√≥n de costo</p>
                    <form @submit.prevent="predecirCosto">
                        <div class="form-group">
                            <label>Longitud (km)</label>
                            <input v-model.number="prediccion.longitud" type="number" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label>N√∫mero de UF's</label>
                            <input v-model.number="prediccion.num_ufs" type="number" required>
                        </div>
                        <button type="submit" class="btn-primary">Predecir Costo</button>
                    </form>
                    <div v-if="costoPredicho" class="resultado-prediccion">
                        <h4>Costo Estimado:</h4>
                        <p class="costo-predicho">${{ formatNumber(costoPredicho) }}</p>
                        <p class="nota">*Esta es una estimaci√≥n basada en proyectos hist√≥ricos</p>
                    </div>
                </div>
            </div>
        </main>
        {% endraw %}
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key={{ maps_api_key }}&callback=initMap"></script>
</body>
</html>

