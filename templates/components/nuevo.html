{% raw %}
<div class="view-form">
    <h2>{{ editingProyecto ? 'Editar Proyecto' : 'Nuevo Proyecto' }}</h2>
    <form @submit.prevent="saveProyecto">
        <!-- Proyecto Principal -->
        <div class="form-section">
            <div class="form-section-title">üìã Informaci√≥n del Proyecto</div>
            <div class="form-grid">
                <div class="form-group">
                    <label>Nombre del Proyecto</label>
                    <input v-model="form.nombre" required>
                </div>
                
                <div class="form-group">
                    <label>C√≥digo</label>
                    <input v-model="form.codigo" required>
                </div>
                
                <div class="form-group">
                    <label>N√∫mero de UF's</label>
                    <input v-model.number="form.num_ufs" type="number" required>
                </div>
                
                <div class="form-group">
                    <label>Longitud (km)</label>
                    <input v-model.number="form.longitud" type="number" step="0.01" required>
                </div>
                
                <div class="form-group">
                    <label>A√±o de Inicio</label>
                    <input v-model.number="form.anio_inicio" type="number" required>
                </div>
                
                <div class="form-group">
                    <label>Duraci√≥n (meses)</label>
                    <input v-model.number="form.duracion" type="number" required>
                </div>
                
                <div class="form-group">
                    <label>Fase</label>
                    <select v-model="form.fase" required>
                        <option>Detalle</option>
                        <option>Ejecuci√≥n</option>
                        <option>Terminado</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Ubicaci√≥n</label>
                    <input v-model="form.ubicacion" required>
                </div>
                
                <div class="form-group">
                    <label>Costo</label>
                    <input v-model.number="form.costo" type="number" step="0.01" required>
                </div>
            </div>
            
            <div class="form-grid">
                <div class="form-group">
                    <label>Latitud Inicio</label>
                    <input v-model.number="form.lat_inicio" type="number" step="0.0001" required>
                </div>
                
                <div class="form-group">
                    <label>Longitud Inicio</label>
                    <input v-model.number="form.lng_inicio" type="number" step="0.0001" required>
                </div>
                
                <div class="form-group">
                    <label>Latitud Fin</label>
                    <input v-model.number="form.lat_fin" type="number" step="0.0001" required>
                </div>
                
                <div class="form-group">
                    <label>Longitud Fin</label>
                    <input v-model.number="form.lng_fin" type="number" step="0.0001" required>
                </div>
            </div>
        </div>

        <!-- Unidades Funcionales -->
        <div class="form-section">
            <div class="form-section-title">
                üèóÔ∏è Unidades Funcionales
                <button type="button" @click="addUnidadFuncional" class="btn-add">+ Agregar UF</button>
            </div>
            
            <div v-for="(uf, index) in form.unidades_funcionales" :key="index" class="nested-form">
                <div class="nested-form-header">
                    <span class="nested-form-title">Unidad Funcional {{ index + 1 }}</span>
                    <button type="button" @click="removeUnidadFuncional(index)" class="btn-remove">Eliminar</button>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>N¬∫ UF</label>
                        <input v-model.number="uf.unidad_funcional" type="number" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Longitud (km)</label>
                        <input v-model.number="uf.longitud_km" type="number" step="0.01" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Puentes Veh. (Und)</label>
                        <input v-model.number="uf.puentes_vehiculares_und" type="number">
                    </div>
                    
                    <div class="form-group">
                        <label>Puentes Veh. (m¬≤)</label>
                        <input v-model.number="uf.puentes_vehiculares_mt2" type="number">
                    </div>
                    
                    <div class="form-group">
                        <label>Puentes Peat. (Und)</label>
                        <input v-model.number="uf.puentes_peatonales_und" type="number">
                    </div>
                    
                    <div class="form-group">
                        <label>Puentes Peat. (m¬≤)</label>
                        <input v-model.number="uf.puentes_peatonales_mt2" type="number">
                    </div>
                    
                    <div class="form-group">
                        <label>T√∫neles (Und)</label>
                        <input v-model.number="uf.tuneles_und" type="number">
                    </div>
                    
                    <div class="form-group">
                        <label>T√∫neles (km)</label>
                        <input v-model.number="uf.tuneles_km" type="number" step="0.01">
                    </div>
                    
                    <div class="form-group">
                        <label>Alcance</label>
                        <select v-model="uf.alcance">
                            <option>Primera calzada</option>
                            <option>Segunda calzada</option>
                            <option>T√∫nel</option>
                            <option>Puente</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Zona</label>
                        <select v-model="uf.zona">
                            <option>Urbana</option>
                            <option>Rural</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Tipo Terreno</label>
                        <select v-model="uf.tipo_terreno">
                            <option>Plano</option>
                            <option>Ondulado</option>
                            <option>Monta√±oso</option>
                            <option>Escarpado</option>
                        </select>
                    </div>
                </div>
            </div>
            
            <p v-if="form.unidades_funcionales.length === 0" class="no-data">No hay unidades funcionales. Haga clic en "+ Agregar UF" para a√±adir.</p>
        </div>

        <!-- Items de Costo -->
        <div class="form-section">
            <div class="form-section-title">
                üí∞ Items de Costo
                <button type="button" @click="addItem" class="btn-add">+ Agregar Item</button>
            </div>
            
            <div v-for="(item, index) in form.items" :key="index" class="nested-form">
                <div class="nested-form-header">
                    <span class="nested-form-title">Item {{ index + 1 }}</span>
                    <button type="button" @click="removeItem(index)" class="btn-remove">Eliminar</button>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label>Descripci√≥n Item</label>
                        <input v-model="item.item" required placeholder="Ej: 1 - TRANSPORTE">
                    </div>
                    
                    <div class="form-group">
                        <label>Causado</label>
                        <input v-model.number="item.causado" type="number" step="0.01" required>
                    </div>
                </div>
            </div>
            
            <p v-if="form.items.length === 0" class="no-data">No hay items de costo. Haga clic en "+ Agregar Item" para a√±adir.</p>
        </div>
        
        <div class="form-actions">
            <button type="submit" class="btn-primary">{{ editingProyecto ? 'Actualizar' : 'Crear' }} Proyecto</button>
            <button type="button" @click="cancelForm" class="btn-secondary">Cancelar</button>
        </div>
    </form>
</div>
{% endraw %}
